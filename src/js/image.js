(function() {
  var ImageSize,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  ImageSize = (function(superClass) {
    extend(ImageSize, superClass);

    function ImageSize(el, callback) {
      ImageSize.__super__.constructor.call(this);
      this.init(el);
      this.bind();
      this.render(callback);
      return this;
    }

    ImageSize.prototype.toString = function() {
      return 'ImageSize';
    };

    ImageSize.prototype.init = function(el) {
      this.el = $(el)[0];
      this.complete = this.el.complete;
      this.data = {};
      this._timer = null;
      this.data.width = this.el.width;
      return this.data.height = this.el.height;
    };

    ImageSize.prototype.bind = function() {
      this.log('bind() is executed');
      return $(window).resize((function(_this) {
        return function(e) {
          var isEqual;
          isEqual = _this.el.width === _this.data.width && _this.el.height === _this.data.height;
          if (isEqual) {
            return;
          }
          $.extend(_this.data, {
            width: _this.el.width,
            height: _this.el.height,
            widthRatio: _this.el.width / _this.data.naturalWidth,
            heightRatio: _this.el.height / _this.data.naturalHeight
          });
          _this.log('handleResize() is executed');
          return _this.emit('change', [_this.data]);
        };
      })(this));
    };

    ImageSize.prototype.render = function(callback) {
      var img;
      this.log('render() is executed');
      if (this.complete) {
        img = new Image();
        img.src = this.el.src;
        this.log("Image '" + this.el.src + "' is loaded");
        this.data.naturalWidth = img.width;
        this.data.naturalHeight = img.height;
        return callback(true, this.data);
      } else {
        this.log("Image '" + this.el.src + "' is NOT ready");
        img = new Image();
        img.src = this.el.src;
        img.onload = (function(_this) {
          return function(e) {
            _this.log("Image '" + img.src + "' is loaded");
            _this.data.naturalWidth = img.width;
            _this.data.naturalHeight = img.height;
            return callback(true, _this.data);
          };
        })(this);
        return img.onerror = (function(_this) {
          return function(e) {
            _this.log("Image '" + img.src + "' is failed to load");
            return callback(false, _this.data);
          };
        })(this);
      }
    };

    return ImageSize;

  })(Stackla.Base);

  if (!window.Stackla) {
    window.Stackla = {};
  }

  Stackla.getImageSize = function(el, callback) {
    return new ImageSize(el, callback);
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,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QSxHQUFHLENBQUMsT0FBSixHQUFjLENBQUEsU0FBQSxLQUFBLEdBQUE7aUJBQUEsU0FBQyxDQUFELEdBQUE7QUFDWixZQUFBLEtBQUMsQ0FBQSxHQUFELENBQUssU0FBQSxHQUFVLEdBQUcsQ0FBQyxHQUFkLEdBQWtCLHFCQUF2QixDQUFBLENBQUE7bUJBQ0EsUUFBQSxDQUFTLEtBQVQsRUFBZ0IsS0FBQyxDQUFBLElBQWpCLEVBRlk7VUFBQSxFQUFBO1FBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxFQWpCaEI7T0FITTtJQUFBLENBaENSLENBQUE7O3FCQUFBOztLQUZzQixPQUFPLENBQUMsS0FBaEMsQ0FBQTs7QUEyREEsRUFBQSxJQUFBLENBQUEsTUFBaUMsQ0FBQyxPQUFsQztBQUFBLElBQUEsTUFBTSxDQUFDLE9BQVAsR0FBaUIsRUFBakIsQ0FBQTtHQTNEQTs7QUFBQSxFQTZEQSxPQUFPLENBQUMsWUFBUixHQUF1QixTQUFDLEVBQUQsRUFBSyxRQUFMLEdBQUE7V0FDakIsSUFBQSxTQUFBLENBQVUsRUFBVixFQUFjLFFBQWQsRUFEaUI7RUFBQSxDQTdEdkIsQ0FBQTtBQUFBIiwiZmlsZSI6ImltYWdlLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgSW1hZ2VTaXplIGV4dGVuZHMgU3RhY2tsYS5CYXNlXG5cbiAgY29uc3RydWN0b3I6IChlbCwgY2FsbGJhY2spIC0+XG4gICAgc3VwZXIoKVxuICAgIEBpbml0KGVsKVxuICAgIEBiaW5kKClcbiAgICBAcmVuZGVyKGNhbGxiYWNrKVxuICAgIHJldHVybiBAXG5cbiAgdG9TdHJpbmc6ICgpIC0+ICdJbWFnZVNpemUnXG5cbiAgaW5pdDogKGVsKSAtPlxuICAgIEBlbCA9ICQoZWwpWzBdXG4gICAgQGNvbXBsZXRlID0gQGVsLmNvbXBsZXRlXG4gICAgQGRhdGEgPSB7fVxuICAgIEBfdGltZXIgPSBudWxsXG4gICAgQGRhdGEud2lkdGggPSBAZWwud2lkdGhcbiAgICBAZGF0YS5oZWlnaHQgPSBAZWwuaGVpZ2h0XG5cbiAgYmluZDogLT5cbiAgICBAbG9nICdiaW5kKCkgaXMgZXhlY3V0ZWQnXG4gICAgIyBLZWVwIGFuIGV5ZSBvbiByZXNpemUgZXZlbnRcbiAgICAkKHdpbmRvdykucmVzaXplIChlKSA9PlxuICAgICAgaXNFcXVhbCA9IEBlbC53aWR0aCBpcyBAZGF0YS53aWR0aCBhbmQgQGVsLmhlaWdodCBpcyBAZGF0YS5oZWlnaHRcbiAgICAgIHJldHVybiBpZiBpc0VxdWFsXG4gICAgICAkLmV4dGVuZCBAZGF0YSwge1xuICAgICAgICB3aWR0aDogQGVsLndpZHRoXG4gICAgICAgIGhlaWdodDogQGVsLmhlaWdodFxuICAgICAgICB3aWR0aFJhdGlvOiBAZWwud2lkdGggLyBAZGF0YS5uYXR1cmFsV2lkdGhcbiAgICAgICAgaGVpZ2h0UmF0aW86IEBlbC5oZWlnaHQgLyBAZGF0YS5uYXR1cmFsSGVpZ2h0XG4gICAgICB9XG4gICAgICBAbG9nICdoYW5kbGVSZXNpemUoKSBpcyBleGVjdXRlZCdcbiAgICAgIEAuZW1pdCgnY2hhbmdlJywgW0BkYXRhXSlcblxuICByZW5kZXI6IChjYWxsYmFjaykgLT5cbiAgICBAbG9nICdyZW5kZXIoKSBpcyBleGVjdXRlZCdcbiAgICAjIEltYWdlIExvYWRlZFxuICAgIGlmIEBjb21wbGV0ZVxuICAgICAgaW1nID0gbmV3IEltYWdlKClcbiAgICAgIGltZy5zcmMgPSBAZWwuc3JjXG4gICAgICBAbG9nIFwiSW1hZ2UgJyN7QGVsLnNyY30nIGlzIGxvYWRlZFwiXG4gICAgICBAZGF0YS5uYXR1cmFsV2lkdGggPSBpbWcud2lkdGhcbiAgICAgIEBkYXRhLm5hdHVyYWxIZWlnaHQgPSBpbWcuaGVpZ2h0XG4gICAgICBjYWxsYmFjayh0cnVlLCBAZGF0YSlcbiAgICAjIEltYWdlIExvYWRpbmdcbiAgICBlbHNlXG4gICAgICBAbG9nIFwiSW1hZ2UgJyN7QGVsLnNyY30nIGlzIE5PVCByZWFkeVwiXG4gICAgICBpbWcgPSBuZXcgSW1hZ2UoKVxuICAgICAgaW1nLnNyYyA9IEBlbC5zcmNcbiAgICAgIGltZy5vbmxvYWQgPSAoZSkgPT5cbiAgICAgICAgQGxvZyBcIkltYWdlICcje2ltZy5zcmN9JyBpcyBsb2FkZWRcIlxuICAgICAgICBAZGF0YS5uYXR1cmFsV2lkdGggPSBpbWcud2lkdGhcbiAgICAgICAgQGRhdGEubmF0dXJhbEhlaWdodCA9IGltZy5oZWlnaHRcbiAgICAgICAgY2FsbGJhY2sodHJ1ZSwgQGRhdGEpXG4gICAgICBpbWcub25lcnJvciA9IChlKSA9PlxuICAgICAgICBAbG9nIFwiSW1hZ2UgJyN7aW1nLnNyY30nIGlzIGZhaWxlZCB0byBsb2FkXCJcbiAgICAgICAgY2FsbGJhY2soZmFsc2UsIEBkYXRhKVxuXG5cbndpbmRvdy5TdGFja2xhID0ge30gdW5sZXNzIHdpbmRvdy5TdGFja2xhXG5cblN0YWNrbGEuZ2V0SW1hZ2VTaXplID0gKGVsLCBjYWxsYmFjaykgLT5cbiAgbmV3IEltYWdlU2l6ZShlbCwgY2FsbGJhY2spXG4iXX0=