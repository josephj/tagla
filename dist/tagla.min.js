(function(){var t;t=function(){function t(t){var a,e;null==t&&(t={}),e=this.getParams("debug"),a=a||{},this.debug=e?"true"===e||"1"===e:a.debug?a.debug===!0:!1,this._listeners=[]}return t.prototype.toString=function(){return"Base"},t.prototype.log=function(t,a){this.debug&&(a=a||"info",window.console&&window.console[a]&&window.console[a]("["+this.toString()+"] "+t))},t.prototype.on=function(t,a){if(!t||!a)throw new Error("Both event type and callback are required parameters");return this.log("on() - event '"+t+"' is subscribed"),this._listeners[t]||(this._listeners[t]=[]),a.instance=this,this._listeners[t].push(a),a},t.prototype.emit=function(t,a){var e,i;if(null==a&&(a=[]),this.log("emit() - event '"+t+"' is triggered"),a.unshift({type:t,target:this}),!t)throw new Error("Lacks of type parameter");if(this._listeners[t]&&this._listeners[t].length){i=[];for(e in this._listeners[t])i.push(this._listeners[t][e].apply(this,a));return i}},t.prototype.getParams=function(t){var a,e,i,n,s,l;i=this.getUrl(),s={},l=i.indexOf("?"),this.log("getParams() is executed"),e=-1!==i.indexOf("#")?i.slice(l+1,i.indexOf("#")).split("&"):i.slice(l+1).split("&");for(n in e)a=e[n].split("="),s[a[0]]=a[1];return t?s[t]:s},t.prototype.getUrl=function(){return window.location.href},t}(),window.Stackla||(window.Stackla={}),window.Stackla.Base=t}).call(this),function(){var t,a=function(t,a){function i(){this.constructor=t}for(var n in a)e.call(a,n)&&(t[n]=a[n]);return i.prototype=a.prototype,t.prototype=new i,t.__super__=a.prototype,t},e={}.hasOwnProperty;t=function(t){function e(t,a){var i;return e.__super__.constructor.call(this),this.el=$(t)[0],this.debug=!0,this.complete=this.el.complete,this.data={width:this.el.width,height:this.el.height,naturalWidth:null,naturalHeight:null},this._timer=null,this.complete?(this.log("Image '"+this.el.src+"' is ready"),i=new Image,i.src=this.el.src,$.extend(this.data,{naturalWidth:i.width,naturalHeight:i.height}),a(!0,this.data)):(this.log("Image '"+this.el.src+"' is NOT ready"),i=new Image,i.src=this.el.src,i.onload=function(t){return function(){return t.log("Image '"+i.src+"' is loaded"),$.extend(t.data,{naturalWidth:i.width,naturalHeight:i.height}),a(!0,t.data)}}(this),i.onerror=function(t){return function(){return t.log("Image '"+i.src+"' is failed to load"),a(!1,t.data)}}(this)),$(window).resize(function(t){return function(){return t._timer&&window.clearTimeout(t._timer),t._timer=window.setTimeout(function(){var a;return(a=t.el.width===t.data.width&&t.el.height===t.data.height)?void 0:($.extend(t.data,{width:t.el.width,height:t.el.height,widthRatio:t.el.width/t.data.naturalWidth,heightRatio:t.el.height/t.data.naturalHeight}),t.emit("change",[t.data]),t._timer=null)},100)}}(this)),this}return a(e,t),e.prototype.toString=function(){return"ImageSize"},e}(Stackla.Base),window.Stackla||(window.Stackla={}),Stackla.getImageSize=function(a,e){return new t(a,e)}}.call(this),function(){var t,a,e,i=function(t,a){function e(){this.constructor=t}for(var i in a)n.call(a,i)&&(t[i]=a[i]);return e.prototype=a.prototype,t.prototype=new e,t.__super__=a.prototype,t},n={}.hasOwnProperty;t={NAME:"Tagla",PREFIX:"tagla-",DRAG_ATTR:{containment:".tagla",handle:".tagla-icon"},SELECT_ATTR:{allow_single_deselect:!0,placeholder_text_single:"Select an option",width:"310px"},FORM_TEMPLATE:[].join("\n"),TAG_TEMPLATE:['<div class="tagla-tag">','    <i class="tagla-icon fs fs-tag"></i>','    <span class="tagla-label">',"      {{label}}",'      <a href="javascript:void(0)" class="tagla-tag-link tagla-tag-edit-link">','        <i class="fs fs-pencil"></i> Edit',"      </a>",'      <a href="javascript:void(0)" class="tagla-tag-link tagla-tag-delete-link">','        <i class="fs fs-cross3"></i> Delete',"      </a>","    </span>",'    <div class="tagla-dialog">',"        {{#image}}",'        <div class="tagla-dialog-image">','          <img src="{{image}}">',"        </div>","        {{/image}}",'        <div class="tagla-dialog-text">','          <div class="tagla-dialog-edit">','            <a href="javascript:void(0)" class="tagla-tag-link tagla-tag-edit-link">','              <i class="fs fs-pencil"></i> Edit',"            </a>",'            <a href="javascript:void(0)" class="tagla-tag-link tagla-tag-delete-link">','              <i class="fs fs-cross3"></i> Delete',"            </a>","          </div>",'          <h2 class="tagla-dialog-title">{{label}}</h2>','          <div class="tagla-dialog-price">{{price}}</div>','          <p class="tagla-dialog-description">{{description}}</p>','          <a href="{{url}}" class="tagla-dialog-button st-btn st-btn-success st-btn-solid">','            <i class="fs fs-cart"></i>',"            Buy Now","          </a>","        </div>","    </div>",'    <form class="tagla-form">','        <div class="tagla-form-title">',"          Select Your Product",'          <a href="javascript:void(0);" class="tagla-form-close">Ã—</a>',"        </div>",'        <input type="hidden" name="x">','        <input type="hidden" name="y">','        <select data-placeholder="Search" type="text" name="tag" class="tagla-select chosen-select" placeholder="Search">',"            <option></option>",'            <option value="1">Cockie</option>','            <option value="2">Kiwi</option>','            <option value="3">Buddy</option>',"        </select>","    </form>","</div>"].join("\n"),NEW_TAG_TEMPLATE:['<div class="tagla-tag">','    <i class="tagla-icon fs fs-tag"></i>','    <span class="tagla-label">{{label}}</span>',"</div>"].join("\n")},a=function(t){function a(t,e){null==e&&(e={}),a.__super__.constructor.call(this),this.wrapper=$(t),this.init(e),this.bind()}return i(a,t),a}(Stackla.Base),$.extend(a,t),e={formatFloat:function(t,a){var e;return e=Math.pow(10,a),Math.round(t*e)/e},toString:function(){return"Tagla"},_applyTools:function(t){var e,i,n;return i=new Draggabilly(t[0],a.DRAG_ATTR),i.on("dragEnd",$.proxy(this.handleTagMove,this)),i.disable(),t.data("draggabilly",i),n=t.data("tag-data"),e=t.find(".tagla-form"),e.find("[name=x]").val(n.x),e.find("[name=y]").val(n.y),e.find("[name=tag] option[value="+n.value+"]").attr("selected","selected"),t.find(".tagla-select").chosen(a.SELECT_ATTR),t.find(".tagla-select").on("change",$.proxy(this.handleTagChange,this))},_removeTools:function(t){var a;return t.data("draggabilly").destroy(),a=t.find(".tagla-select"),a.show().removeClass("chzn-done"),a.next().remove()},_getPosition:function(t){var a,e,i;return this.log("_getPosition() is executed"),a=t.position(),e=(a.left+t.width()/2)/this.currentWidth*this.naturalWidth,i=(a.top+t.height()/2)/this.currentHeight*this.naturalWidth,"percent"===this.unit&&(e=e/this.naturalWidth*100,i=i/this.naturalHeight*100),[e,i]},_updateImageSize:function(t){var a;this.log("_updateImageSize() is executed");try{return this.naturalWidth=t.naturalWidth,this.naturalHeight=t.naturalHeight,this.currentWidth=t.width,this.currentHeight=t.height,this.widthRatio=t.widthRatio,this.heightRatio=t.heightRatio}catch(e){return a=e,console.error(a)}},handleTagClick:function(t){var a;return t.preventDefault(),t.stopPropagation(),$(t.target).hasClass("tagla-icon")?(this.log("handleTagClick() is executed"),a=$(t.currentTarget),this.shrink(a),a.addClass("tagla-tag-active"),a.data("draggabilly").enable()):void 0},handleTagChange:function(t){var a,e,i,n;return this.log("handleTagChange() is executed"),a=$(t.target),e=a.parents(".tagla-tag"),e.removeClass("tagla-tag-choose tagla-tag-active"),i=e.data("tag-data"),i.label=a.find("option:selected").text(),i.value=a.val()||i.label,n=e.find(".tagla-form").serialize(),this.emit("change",[i,n,e])},handleTagDelete:function(t){var a,e,i;return this.log("handleTagDelete() is executed"),t.preventDefault(),a=$(t.currentTarget).parents(".tagla-tag"),a.remove(),i=a.data("draggabilly"),i&&i.destroy(),e=a.data("tag-data"),this.emit("delete",[e])},handleTagEdit:function(t){var a;return this.log("handleTagDelete() is executed"),t.preventDefault(),a=$(t.currentTarget).parents(".tagla-tag"),a.addClass("tagla-tag-choose"),a.find(".tagla-select").trigger("chosen:open"),this.emit("tagla:edit",[a.data("tag-data")])},handleTagMove:function(t){var a,e,i,n,s;return this.log("handleTagMove() is executed"),e=$(t.element),i=e.data("tag-data"),n=this._getPosition(e),i.x=n[0],i.y=n[1],a=e.find(".tagla-form"),a.find("[name=x]").val(i.x),a.find("[name=y]").val(i.y),s=e.find(".tagla-form").serialize(),this.emit("move",[i,s,e])},handleWrapperClick:function(){return this.log("handleWrapperClick() is executed"),this.shrink()},handleImageResize:function(t,a){var e,i;return this.log("handleImageResize() is executed"),i=this.currentWidth,e=this.currentHeight,$(".tagla-tag").each(function(){var t,n,s,l;return t=$(this),n=t.position(),s=n.left/i*a.width,l=n.top/e*a.height,t.css({left:s+"px",top:l+"px"})}),this._updateImageSize(a)},addTag:function(t){var a,e,i,n,s,l;return null==t&&(t={}),this.log("addTag() is executed"),a=$(Mustache.render(this.tagTemplate,t)),e=$.isEmptyObject(t),this.wrapper.append(a),e&&(t.x=50,t.y=50,a.addClass("tagla-tag-new tagla-tag-active tagla-tag-choose")),"percent"===this.unit?(s=this.currentWidth*(t.x/100),l=this.currentHeight*(t.y/100)):(s=t.x*this.widthRatio,l=t.y*this.heightRatio),i=a.outerWidth()/2,n=a.outerHeight()/2,a.css({left:s-i+"px",top:l-n+"px"}),a.data("tag-data",t),this.editor&&(this._applyTools(a),e)?(a.data("draggabilly").enable(),a.addClass("tagla-tag-choose"),a.find(".tagla-select").trigger("chosen:open")):void 0},deleteTag:function(){return this.log("deleteTag() is executed")},edit:function(){return this.editor!==!0?(this.log("edit() is executed"),this.wrapper.addClass("tagla-editing"),$(".tagla-tag").each(function(){return this._applyTools($(this))}),this.editor=!0):void 0},shrink:function(t){return null==t&&(t=null),this.editor!==!1?(this.log("shrink() is executed"),t=$(t),$(".tagla-tag").each(function(){var a;if(t[0]!==this)return a=$(this),a.hasClass("tagla-tag-new")&&!a.find("[name=tag]").val()&&a.remove(),a.removeClass("tagla-tag-active tagla-tag-choose"),a.data("draggabilly").disable()})):void 0},updateDialog:function(t,a){var e;return e=$(Mustache.render(this.tagTemplate,a)).find(".tagla-dialog").html(),t.find(".tagla-dialog").html(e),t.data("tag-data",a)},unedit:function(){return this.edit!==!1?(this.log("unedit() is executed"),$(".tagla-tag").each(function(){return this._removeTools($(this))}),this.wrapper.removeClass("tagla-editing"),this.editor=!1):void 0},init:function(t){var e;return this.data=t.data||[],this.editor=null!=(e=t.editor===!0)?e:{on:!1},this.form=t.form?$(t.form):a.FORM_TEMPLATE,this.tagTemplate=t.tagTemplate?$(t.tagTemplate).html():a.TAG_TEMPLATE,this.unit="percent"===t.unit?"percent":"pixel",this.imageSize=null,this.image=this.wrapper.find("img")},bind:function(){return this.log("bind() is executed"),this.wrapper.on("mouseenter",$.proxy(this.handleMouseEnter,this)).on("click",$.proxy(this.handleWrapperClick,this)).on("click",".tagla-tag",$.proxy(this.handleTagClick,this)).on("click",".tagla-tag-edit-link",$.proxy(this.handleTagEdit,this)).on("click",".tagla-tag-delete-link",$.proxy(this.handleTagDelete,this))},renderFn:function(t,a){var e,i,n,s,l;if(!t)return this.log("Failed to load image: "+this.image.attr("src"),"error"),void this.destroy();for(this._updateImageSize(a),this.wrapper.addClass("tagla"),this.editor&&this.wrapper.addClass("tagla-editing"),s=this.data,l=[],i=0,n=s.length;n>i;i++)e=s[i],l.push(this.addTag(e));return l},render:function(){return this.log("render() is executed"),this.imageSize=Stackla.getImageSize(this.image,$.proxy(this.renderFn,this)),this.imageSize.on("change",$.proxy(this.handleImageResize,this))},destroy:function(){return this.log("destroy() is executed")}},$.extend(a.prototype,e),window.Stackla||(window.Stackla={}),window.Stackla.Tagla=a}.call(this);