!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Tagla=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(b,c,d){function e(a,b){var c=this;if(c.overlay=$(a),c.relateTo=$(b.relateTo)||null,c.constrainBy=$(b.constrainBy)||null,c.skipViewport=b.skipViewport===!1?!1:!0,!c.overlay)throw new Error("`overlay` element is required");if(!c.relateTo)throw new Error("`relateTo` option is required")}var f,g,h,i;f=function(a,b){var c,d,e,f=0;for(d in a)a.hasOwnProperty(d)&&(e=a[d],e[b]>f&&(f=e[b],c=e));return c},g=function(a){var b=a.offset(),c=a.outerWidth(),d=a.outerHeight();return{left:b.left,top:b.top,right:b.left+c,bottom:b.top+d,width:c,height:d}},h=function(a,b){b.left+b.width/2-a.width/2;return[{left:b.left,top:b.top-a.height,name:"lblt"},{left:b.right-a.width,top:b.top-a.height,name:"rbrt"},{left:b.right,top:b.top,name:"ltrt"},{left:b.right,top:b.bottom-a.height,name:"lbrb"},{left:b.right-a.width,top:b.bottom,name:"rtrb"},{left:b.left,top:b.bottom,name:"ltlb"},{left:b.left-a.width,top:b.bottom-a.height,name:"rblb"},{left:b.left-a.width,top:b.top,name:"rtlt"}]},i=function(a){var b=$(window),c=b.scrollTop(),d=c+b.height();return c>a&&(a.top=c),d<a.bottom&&(a.bottom=d,a.height=d-c),a},e.prototype.align=function(){var a,b,c=this,d=c.overlay,e=g(d),j=g(c.relateTo),k=g(c.constrainBy),l=h(e,j),m=!1,n={};c.skipViewport||i(k);for(b in l)l.hasOwnProperty(b)&&(a=l[b],a.right=a.left+e.width,a.bottom=a.top+e.height,a.left>=k.left&&a.top>=k.top&&a.right<=k.right&&a.bottom<=k.bottom?(a.inDistance=Math.min.apply(null,[a.top-k.top,k.right-a.left+e.width,k.bottom-a.top+e.height,a.left-k.left]),m=!0):a.overlapSize=(Math.min(a.right,k.right)-Math.max(a.left,k.left))*(Math.min(a.bottom,k.bottom)-Math.max(a.top,k.top)));return n=m?f(l,"inDistance"):f(l,"overlapSize"),d.offset(n),n},window.Stackla?window.Stackla.AlignMe=e:window.AlignMe=e,"object"==typeof d&&d?c.exports=e:"function"==typeof a&&a.amd&&a(["exports"],e)},{}],2:[function(b,c,d){!function(b,c){"object"==typeof d&&d?c(d):"function"==typeof a&&a.amd?a(["exports"],c):c(b.Mustache={})}(this,function(a){function b(a){return"function"==typeof a}function c(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function d(a,b){return o.call(a,b)}function e(a){return!d(p,a)}function f(a){return String(a).replace(/[&<>"'\/]/g,function(a){return q[a]})}function g(b,d){function f(){if(w&&!x)for(;q.length;)delete p[q.pop()];else q=[];w=!1,x=!1}function g(a){if("string"==typeof a&&(a=a.split(s,2)),!n(a)||2!==a.length)throw new Error("Invalid tags: "+a);k=new RegExp(c(a[0])+"\\s*"),l=new RegExp("\\s*"+c(a[1])),m=new RegExp("\\s*"+c("}"+a[1]))}if(!b)return[];var k,l,m,o=[],p=[],q=[],w=!1,x=!1;g(d||a.tags);for(var y,z,A,B,C,D,E=new j(b);!E.eos();){if(y=E.pos,A=E.scanUntil(k))for(var F=0,G=A.length;G>F;++F)B=A.charAt(F),e(B)?q.push(p.length):x=!0,p.push(["text",B,y,y+1]),y+=1,"\n"===B&&f();if(!E.scan(k))break;if(w=!0,z=E.scan(v)||"name",E.scan(r),"="===z?(A=E.scanUntil(t),E.scan(t),E.scanUntil(l)):"{"===z?(A=E.scanUntil(m),E.scan(u),E.scanUntil(l),z="&"):A=E.scanUntil(l),!E.scan(l))throw new Error("Unclosed tag at "+E.pos);if(C=[z,A,y,E.pos],p.push(C),"#"===z||"^"===z)o.push(C);else if("/"===z){if(D=o.pop(),!D)throw new Error('Unopened section "'+A+'" at '+y);if(D[1]!==A)throw new Error('Unclosed section "'+D[1]+'" at '+y)}else"name"===z||"{"===z||"&"===z?x=!0:"="===z&&g(A)}if(D=o.pop())throw new Error('Unclosed section "'+D[1]+'" at '+E.pos);return i(h(p))}function h(a){for(var b,c,d=[],e=0,f=a.length;f>e;++e)b=a[e],b&&("text"===b[0]&&c&&"text"===c[0]?(c[1]+=b[1],c[3]=b[3]):(d.push(b),c=b));return d}function i(a){for(var b,c,d=[],e=d,f=[],g=0,h=a.length;h>g;++g)switch(b=a[g],b[0]){case"#":case"^":e.push(b),f.push(b),e=b[4]=[];break;case"/":c=f.pop(),c[5]=b[2],e=f.length>0?f[f.length-1][4]:d;break;default:e.push(b)}return d}function j(a){this.string=a,this.tail=a,this.pos=0}function k(a,b){this.view=null==a?{}:a,this.cache={".":this.view},this.parent=b}function l(){this.cache={}}var m=Object.prototype.toString,n=Array.isArray||function(a){return"[object Array]"===m.call(a)},o=RegExp.prototype.test,p=/\S/,q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},r=/\s*/,s=/\s+/,t=/\s*=/,u=/\s*\}/,v=/#|\^|\/|>|\{|&|=|!/;j.prototype.eos=function(){return""===this.tail},j.prototype.scan=function(a){var b=this.tail.match(a);if(!b||0!==b.index)return"";var c=b[0];return this.tail=this.tail.substring(c.length),this.pos+=c.length,c},j.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c)}return this.pos+=b.length,b},k.prototype.push=function(a){return new k(a,this)},k.prototype.lookup=function(a){var c,d=this.cache;if(a in d)c=d[a];else{for(var e,f,g=this;g;){if(a.indexOf(".")>0)for(c=g.view,e=a.split("."),f=0;null!=c&&f<e.length;)c=c[e[f++]];else"object"==typeof g.view&&(c=g.view[a]);if(null!=c)break;g=g.parent}d[a]=c}return b(c)&&(c=c.call(this.view)),c},l.prototype.clearCache=function(){this.cache={}},l.prototype.parse=function(a,b){var c=this.cache,d=c[a];return null==d&&(d=c[a]=g(a,b)),d},l.prototype.render=function(a,b,c){var d=this.parse(a),e=b instanceof k?b:new k(b);return this.renderTokens(d,e,c,a)},l.prototype.renderTokens=function(a,b,c,d){for(var e,f,g,h="",i=0,j=a.length;j>i;++i)g=void 0,e=a[i],f=e[0],"#"===f?g=this._renderSection(e,b,c,d):"^"===f?g=this._renderInverted(e,b,c,d):">"===f?g=this._renderPartial(e,b,c,d):"&"===f?g=this._unescapedValue(e,b):"name"===f?g=this._escapedValue(e,b):"text"===f&&(g=this._rawValue(e)),void 0!==g&&(h+=g);return h},l.prototype._renderSection=function(a,c,d,e){function f(a){return g.render(a,c,d)}var g=this,h="",i=c.lookup(a[1]);if(i){if(n(i))for(var j=0,k=i.length;k>j;++j)h+=this.renderTokens(a[4],c.push(i[j]),d,e);else if("object"==typeof i||"string"==typeof i)h+=this.renderTokens(a[4],c.push(i),d,e);else if(b(i)){if("string"!=typeof e)throw new Error("Cannot use higher-order sections without the original template");i=i.call(c.view,e.slice(a[3],a[5]),f),null!=i&&(h+=i)}else h+=this.renderTokens(a[4],c,d,e);return h}},l.prototype._renderInverted=function(a,b,c,d){var e=b.lookup(a[1]);return!e||n(e)&&0===e.length?this.renderTokens(a[4],b,c,d):void 0},l.prototype._renderPartial=function(a,c,d){if(d){var e=b(d)?d(a[1]):d[a[1]];return null!=e?this.renderTokens(this.parse(e),c,d,e):void 0}},l.prototype._unescapedValue=function(a,b){var c=b.lookup(a[1]);return null!=c?c:void 0},l.prototype._escapedValue=function(b,c){var d=c.lookup(b[1]);return null!=d?a.escape(d):void 0},l.prototype._rawValue=function(a){return a[1]},a.name="mustache.js",a.version="1.1.0",a.tags=["{{","}}"];var w=new l;a.clearCache=function(){return w.clearCache()},a.parse=function(a,b){return w.parse(a,b)},a.render=function(a,b,c){return w.render(a,b,c)},a.to_html=function(c,d,e,f){var g=a.render(c,d,e);return b(f)?void f(g):g},a.escape=f,a.Scanner=j,a.Context=k,a.Writer=l})},{}],3:[function(a,b){var c;c=function(){function a(a){var b,c;null==a&&(a={}),c=this.getParams("debug"),b=b||{},this.debug=c?"true"===c||"1"===c:b.debug?b.debug===!0:!1,this._listeners=[]}return a.prototype.toString=function(){return"Base"},a.prototype.log=function(a,b){this.debug&&(b=b||"info",window.console&&window.console[b]&&window.console[b]("["+this.toString()+"] "+a))},a.prototype.on=function(a,b){if(!a||!b)throw new Error("Both event type and callback are required parameters");return this.log("on() - event '"+a+"' is subscribed"),this._listeners[a]||(this._listeners[a]=[]),b.instance=this,this._listeners[a].push(b),b},a.prototype.emit=function(a,b){var c;if(null==b&&(b=[]),this.log("emit() - event '"+a+"' is triggered"),b.unshift({type:a,target:this}),!a)throw new Error("Lacks of type parameter");if(this._listeners[a]&&this._listeners[a].length)for(c in this._listeners[a])this._listeners[a][c].apply(this,b);return this},a.prototype.getParams=function(a){var b,c,d,e,f,g;d=this.getUrl(),f={},g=d.indexOf("?"),this.log("getParams() is executed"),c=-1!==d.indexOf("#")?d.slice(g+1,d.indexOf("#")).split("&"):d.slice(g+1).split("&");for(e in c)b=c[e].split("="),f[b[0]]=b[1];return a?f[a]:f},a.prototype.getUrl=function(){return window.location.href},a}(),window.Stackla||(window.Stackla={}),window.Stackla.Base=c,b.exports=c},{}],4:[function(a,b){var c;c=function(){function a(a){var b,c;null==a&&(a={}),c=this.getParams("debug"),b=b||{},this.debug=c?"true"===c||"1"===c:b.debug?b.debug===!0:!1,this._listeners=[]}return a.prototype.toString=function(){return"Base"},a.prototype.log=function(a,b){this.debug&&(b=b||"info",window.console&&window.console[b]&&window.console[b]("["+this.toString()+"] "+a))},a.prototype.on=function(a,b){if(!a||!b)throw new Error("Both event type and callback are required parameters");return this.log("on() - event '"+a+"' is subscribed"),this._listeners[a]||(this._listeners[a]=[]),b.instance=this,this._listeners[a].push(b),b},a.prototype.emit=function(a,b){var c;if(null==b&&(b=[]),this.log("emit() - event '"+a+"' is triggered"),b.unshift({type:a,target:this}),!a)throw new Error("Lacks of type parameter");if(this._listeners[a]&&this._listeners[a].length)for(c in this._listeners[a])this._listeners[a][c].apply(this,b);return this},a.prototype.getParams=function(a){var b,c,d,e,f,g;d=this.getUrl(),f={},g=d.indexOf("?"),this.log("getParams() is executed"),c=-1!==d.indexOf("#")?d.slice(g+1,d.indexOf("#")).split("&"):d.slice(g+1).split("&");for(e in c)b=c[e].split("="),f[b[0]]=b[1];return a?f[a]:f},a.prototype.getUrl=function(){return window.location.href},a}(),window.Stackla||(window.Stackla={}),window.Stackla.Base=c,b.exports=c},{}],5:[function(a,b){var c,d,e=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f={}.hasOwnProperty;c=a("./base"),d=function(a){function b(a,c){return b.__super__.constructor.call(this),this.init(a),this.bind(),this.render(c),this}return e(b,a),b.prototype.toString=function(){return"ImageSize"},b.prototype.init=function(a){return this.el=$(a)[0],this.complete=this.el.complete,this.data={},this._timer=null,this.data.width=this.el.width,this.data.height=this.el.height},b.prototype.bind=function(){return this.log("bind() is executed"),$(window).resize(function(a){return function(){var b;return(b=a.el.width===a.data.width&&a.el.height===a.data.height)?void 0:($.extend(a.data,{width:a.el.width,height:a.el.height,widthRatio:a.el.width/a.data.naturalWidth,heightRatio:a.el.height/a.data.naturalHeight}),a.log("handleResize() is executed"),a.emit("change",[a.data]))}}(this))},b.prototype.render=function(a){var b;return this.log("render() is executed"),this.complete?(b=new Image,b.src=this.el.src,this.log("Image '"+this.el.src+"' is loaded"),this.data.naturalWidth=b.width,this.data.naturalHeight=b.height,a(!0,this.data)):(this.log("Image '"+this.el.src+"' is NOT ready"),b=new Image,b.src=this.el.src,b.onload=function(c){return function(){return c.log("Image '"+b.src+"' is loaded"),c.data.naturalWidth=b.width,c.data.naturalHeight=b.height,a(!0,c.data)}}(this),b.onerror=function(c){return function(){return c.log("Image '"+b.src+"' is failed to load"),a(!1,c.data)}}(this))},b}(c),window.Stackla||(window.Stackla={}),Stackla.getImageSize=function(a,b){return new d(a,b)},b.exports={get:function(a,b){return new d(a,b)}}},{"./base":4}],6:[function(b,c,d){var e,f,g,h,i,j,k,l=function(a,b){function c(){this.constructor=a}for(var d in b)m.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},m={}.hasOwnProperty;i=b("mustache"),f=b("alignme"),g=b("./base.coffee"),h=b("./image.coffee"),e={NAME:"Tagla",PREFIX:"tagla-",DRAG_ATTR:{containment:".tagla",handle:".tagla-icon"},SELECT_ATTR:{allow_single_deselect:!0,placeholder_text_single:"Select an option",width:"310px"},FORM_TEMPLATE:['<div class="tagla-form-wrapper">','    <form class="tagla-form">','        <div class="tagla-form-title">',"            Select Your Product",'            <a href="javascript:void(0);" class="tagla-form-close">Ã—</a>',"        </div>",'        <input type="hidden" name="x">','        <input type="hidden" name="y">','        <select data-placeholder="Search" type="text" name="tag" class="tagla-select chosen-select" placeholder="Search">',"            <option></option>",'            <option value="1">Cockie</option>','            <option value="2">Kiwi</option>','            <option value="3">Buddy</option>',"        </select>","    </form>","</div>"].join("\n"),TAG_TEMPLATE:['<div class="tagla-tag">','    <i class="tagla-icon fs fs-tag2"></i>','    <div class="tagla-dialog">',"    {{#product}}","        {{#image_small_url}}",'        <div class="tagla-dialog-image">','          <img src="{{image_small_url}}">',"        </div>","        {{/image_small_url}}",'        <div class="tagla-dialog-text">','          <div class="tagla-dialog-edit">','            <a href="javascript:void(0)" class="tagla-tag-link tagla-tag-edit-link">','              <i class="fs fs-pencil"></i> Edit',"            </a>",'            <a href="javascript:void(0)" class="tagla-tag-link tagla-tag-delete-link">','              <i class="fs fs-cross3"></i> Delete',"            </a>","          </div>",'          <h2 class="tagla-dialog-title">{{tag}}</h2>',"          {{#price}}",'          <div class="tagla-dialog-price">{{price}}</div>',"          {{/price}}","          {{#description}}",'          <p class="tagla-dialog-description">{{description}}</p>',"          {{/description}}","          {{#custom_url}}",'          <a href="{{custom_url}}" class="tagla-dialog-button st-btn st-btn-success st-btn-solid" target="{{target}}">','            <i class="fs fs-cart"></i>',"            Buy Now","          </a>","          {{/custom_url}}","        </div>","    {{/product}}","    </div>","    {{{form_html}}}","</div>"].join("\n"),NEW_TAG_TEMPLATE:['<div class="tagla-tag">','    <i class="tagla-icon fs fs-tag2"></i>',"</div>"].join("\n")},j=function(a){function b(a,c){null==c&&(c={}),b.__super__.constructor.call(this),this.wrapper=$(a),this.init(c),this.bind()}return l(b,a),b}(g),$.extend(j,e),k={toString:function(){return"Tagla"},_applyTools:function(a){var b,c,d,e;return this.log("_applyTools() is executed"),d=new Draggabilly(a[0],j.DRAG_ATTR),d.on("dragEnd",$.proxy(this.handleTagMove,this)),a.data("draggabilly",d),e=a.data("tag-data"),b=a.find(".tagla-form"),b.find("[name=x]").val(e.x),b.find("[name=y]").val(e.y),b.find("[name=tag] option[value="+e.value+"]").attr("selected","selected"),c=a.find(".tagla-select"),c.chosen2(j.SELECT_ATTR),c.on("change",$.proxy(this.handleTagChange,this)),c.on("chosen:hiding_dropdown",function(){return c.trigger("chosen:open")})},_disableDrag:function(a){return this.editor!==!1?(this.log("_disableDrag() is executed"),a=$(a),$(".tagla-tag").each(function(){return a[0]!==this?$(this).data("draggabilly").disable():void 0})):void 0},_enableDrag:function(a){return this.editor!==!1?(this.log("_enableDrag() is executed"),a=$(a),$(".tagla-tag").each(function(){return a[0]!==this?$(this).data("draggabilly").enable():void 0})):void 0},_removeTools:function(a){var b;return a.data("draggabilly").destroy(),b=a.find(".tagla-select"),b.show().removeClass("chzn-done"),b.next().remove()},_getPosition:function(a){var b,c,d;return this.log("_getPosition() is executed"),b=a.position(),c=(b.left+a.width()/2)/this.currentWidth*this.naturalWidth,d=(b.top+a.height()/2)/this.currentHeight*this.naturalHeight,"percent"===this.unit&&(c=c/this.naturalWidth*100,d=d/this.naturalHeight*100),[c,d]},_updateImageSize:function(a){return this.log("_updateImageSize() is executed"),this.naturalWidth=a.naturalWidth,this.naturalHeight=a.naturalHeight,this.currentWidth=a.width,this.currentHeight=a.height,this.widthRatio=a.widthRatio,this.heightRatio=a.heightRatio},handleTagClick:function(a){var b;return a.preventDefault(),a.stopPropagation(),$(a.target).hasClass("tagla-icon")?(this.log("handleTagClick() is executed"),b=$(a.currentTarget),this.shrink(b),b.addClass("tagla-tag-active"),b.data("draggabilly").enable()):void 0},handleTagChange:function(a){var b,c,d,e,f;return this.log("handleTagChange() is executed"),b=$(a.target),c=b.parents(".tagla-tag"),e=c.hasClass("tagla-tag-new"),c.removeClass("tagla-tag-choose tagla-tag-active tagla-tag-new"),d=$.extend({},c.data("tag-data")),d.label=b.find("option:selected").text(),d.value=b.val()||d.label,f=c.find(".tagla-form").serialize(),c.data("align-dialog").align(),c.data("align-form").align(),e?this.emit("add",[d,f,c]):this.emit("change",[d,f,c])},handleTagDelete:function(a){var b,c;return this.log("handleTagDelete() is executed"),a.preventDefault(),b=$(a.currentTarget).parents(".tagla-tag"),c=$.extend({},b.data("tag-data")),b.fadeOut(function(a){return function(){return a._removeTools(b),b.remove(),a.emit("delete",[c])}}(this))},handleTagEdit:function(a){var b,c;return this.log("handleTagEdit() is executed"),a.preventDefault(),a.stopPropagation(),b=$(a.currentTarget).parents(".tagla-tag"),b.addClass("tagla-tag-choose"),this.wrapper.addClass("tagla-editing-selecting"),this._disableDrag(b),b.find(".tagla-select").trigger("chosen:open"),c=$.extend({},b.data("tag-data")),this.emit("edit",[c,b])},handleTagMove:function(a){var b,c,d,e,f,g;return this.log("handleTagMove() is executed"),c=$(a.element),d=c.data("tag-data"),f=this._getPosition(c),d.x=f[0],d.y=f[1],b=c.find(".tagla-form"),b.find("[name=x]").val(d.x),b.find("[name=y]").val(d.y),g=c.find(".tagla-form").serialize(),this.lastDragTime=new Date,d=$.extend({},d),e=d.id?!1:!0,c.data("align-form").align(),c.data("align-dialog").align(),this.emit("move",[d,g,c,e])},handleTagMouseEnter:function(a){var b,c;return this.log("handleTagMouseEnter"),b=$(a.currentTarget),c=b.data("timer"),c&&clearTimeout(c),b.removeData("timer"),b.addClass("tagla-tag-hover"),b.data("align-dialog").align(),b.data("align-form").align(),this.emit("hover",[b])},handleTagMouseLeave:function(a){var b,c;return this.log("handleTagMouseLeave"),b=$(a.currentTarget),c=b.data("timer"),c&&clearTimeout(c),b.removeData("timer"),c=setTimeout(function(){return b.removeClass("tagla-tag-hover")},300),b.data("timer",c)},handleWrapperClick:function(){return this.log("handleWrapperClick() is executed"),new Date-this.lastDragTime>10?this.shrink():void 0},handleImageResize:function(a,b){var c,d;return this.log("handleImageResize() is executed"),d=this.currentWidth,c=this.currentHeight,$(".tagla-tag").each(function(){var a,e,f,g;return a=$(this),e=a.position(),f=e.left/d*b.width,g=e.top/c*b.height,a.css({left:f+"px",top:g+"px"})}),this._updateImageSize(b)},addTag:function(a){var b,c,d,e,g,h,j,k,l;return null==a&&(a={}),this.log("addTag() is executed"),a=$.extend({},a),a.form_html=this.formHtml,d=$(i.render(this.tagTemplate,a)),g=!a.x&&!a.y,g&&$(".tagla-tag").each(function(){return $(this).hasClass("tagla-tag-new")&&!$(this).find("[name=tag]").val()?$(this).fadeOut(function(a){return function(){return a._removeTools(d)}}(this)):void 0}),this.wrapper.append(d),g&&(a.x=50,a.y=50,d.addClass("tagla-tag-new tagla-tag-active tagla-tag-choose")),"percent"===this.unit?(k=this.currentWidth*(a.x/100),l=this.currentHeight*(a.y/100)):(k=a.x*this.widthRatio,l=a.y*this.heightRatio),h=d.outerWidth()/2,j=d.outerHeight()/2,d.css({left:k-h+"px",top:l-j+"px"}),d.data("tag-data",a),b=d.find(".tagla-dialog"),c=d.find(".tagla-form"),e={relateTo:d,constrainBy:this.wrapper,skipViewport:!1},d.data("align-dialog",new f(b,e)),d.data("align-form",new f(c,e)),d.data("align-dialog").align(),d.data("align-form").align(),this.editor&&(this._applyTools(d),g)?(d.data("draggabilly").enable(),d.addClass("tagla-tag-choose"),setTimeout(function(a){return function(){return a.wrapper.addClass("tagla-editing-selecting"),d.find(".tagla-select").trigger("chosen:open"),a._disableDrag(d),a.emit("new",[d])}}(this),100)):void 0},deleteTag:function(){return this.log("deleteTag() is executed")},edit:function(){return this.editor!==!0?(this.log("edit() is executed"),this.wrapper.addClass("tagla-editing"),$(".tagla-tag").each(function(){return this._applyTools($(this))}),this.editor=!0):void 0},getTags:function(){var a;return this.log("getTags() is executed"),a=[],$(".tagla-tag").each(function(){var b;return b=$.extend({},$(this).data("tag-data")),a.push($(this).data("tag-data"))}),a},shrink:function(a){return null==a&&(a=null),this.editor!==!1?(this.log("shrink() is executed"),a=$(a),$(".tagla-tag").each(function(b){return function(c,d){var e;if(a[0]!==d)return e=$(d),e.hasClass("tagla-tag-new")&&!e.find("[name=tag]").val()&&e.fadeOut(function(){return e.remove(),b._removeTools(e)}),e.removeClass("tagla-tag-active tagla-tag-choose")}}(this)),this.wrapper.removeClass("tagla-editing-selecting"),this._enableDrag()):void 0},updateDialog:function(a,b){var c;return b=$.extend({},a.data("tag-data"),b),b.form_html=this.formHtml,c=$(i.render(this.tagTemplate,b)).find(".tagla-dialog").html(),a.find(".tagla-dialog").html(c),a.data("tag-data",b)},unedit:function(){return this.edit!==!1?(this.log("unedit() is executed"),$(".tagla-tag").each(function(a){return function(b,c){return a._removeTools($(c))}}(this)),this.wrapper.removeClass("tagla-editing"),this.editor=!1):void 0},init:function(a){var b;return this.data=a.data||[],this.editor=null!=(b=a.editor===!0)?b:{on:!1},this.formHtml=$(a.form?a.form:j.FORM_TEMPLATE),this.formHtml=this.formHtml.html(),this.tagTemplate=a.tagTemplate?$(a.tagTemplate).html():j.TAG_TEMPLATE,this.unit="percent"===a.unit?"percent":"pixel",this.imageSize=null,this.image=this.wrapper.find("img"),this.lastDragTime=new Date},bind:function(){return this.log("bind() is executed"),this.wrapper.on("mouseenter",$.proxy(this.handleMouseEnter,this)).on("click",$.proxy(this.handleWrapperClick,this)).on("click",".tagla-tag-edit-link",$.proxy(this.handleTagEdit,this)).on("click",".tagla-tag-delete-link",$.proxy(this.handleTagDelete,this)).on("mouseenter",".tagla-tag",$.proxy(this.handleTagMouseEnter,this)).on("mouseleave",".tagla-tag",$.proxy(this.handleTagMouseLeave,this))},render:function(){return this.log("render() is executed"),this.image.attr("draggable",!1),this.imageSize=h.get(this.image,$.proxy(this.renderFn,this)),this.imageSize.on("change",$.proxy(this.handleImageResize,this))},renderFn:function(a,b){var c,d,e,f,g;if(this.log("renderFn() is executed"),c=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor),!a)return this.log("Failed to load image: "+this.image.attr("src"),"error"),void this.destroy();for(this._updateImageSize(b),this.wrapper.addClass("tagla"),c&&this.wrapper.addClass("tagla-safari"),f=this.data,d=0,e=f.length;e>d;d++)g=f[d],this.addTag(g);return setTimeout(function(a){return function(){return a.editor&&a.wrapper.addClass("tagla-editing"),a.emit("ready",[a])}}(this),500)},destroy:function(){return this.log("destroy() is executed"),this.wrapper.removeClass("tagla tagla-editing"),this.wrapper.find(".tagla-tag").each(function(){var a;return a=$(this),a.find(".tagla-select").chosen2("destroy"),a.data("draggabilly").destroy(),a.remove()})}},$.extend(j.prototype,k),window.Tagla=j,window.Stackla&&(window.Stackla.Tagla=j),"object"==typeof d&&d?c.exports=j:"function"==typeof a&&a.amd&&a(["exports"],j)},{"./base.coffee":3,"./image.coffee":5,alignme:1,mustache:2}]},{},[6])(6)});